<!DOCTYPE html>
<html lang="en">
  <head>
    <title>OAuth2  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset="utf-8">
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
    <script src="js/lunr.min.js" defer></script>
    <script src="js/typeahead.jquery.js" defer></script>
    <script src="js/jazzy.search.js" defer></script>
  </head>
  <body>


    <a title="OAuth2  Reference"></a>

    <header class="header">
      <p class="header-col header-col--primary">
        <a class="header-link" href="index.html">
          OAuth2 5.3.3 Docs
        </a>
         (97% documented)
      </p>
    
      <div class="header-col--secondary">
        <form role="search" action="search.json">
          <input type="text" placeholder="Search documentation" data-typeahead>
        </form>
      </div>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="https://github.com/p2/OAuth2">
            <img class="header-icon" src="img/gh.png" alt="GitHub"/>
            View on GitHub
          </a>
        </p>
    
        <p class="header-col header-col--secondary">
          <a class="header-link" href="dash-feed://https%3A%2F%2Fp2.github.io%2FOAuth2%2Fdocsets%2FOAuth2.xml">
            <img class="header-icon" src="img/dash.png" alt="Dash"/>
            Install in Dash
          </a>
        </p>
    </header>

    <p class="breadcrumbs">
      <a class="breadcrumb" href="index.html">OAuth2 Reference</a>
      <img class="carat" src="img/carat.png" alt=""/>
      OAuth2  Reference
    </p>

    <div class="content-wrapper">
      <nav class="navigation">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Flows.html">Flows</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/OAuth2CodeGrant.html">OAuth2CodeGrant</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/OAuth2CodeGrantBasicAuth.html">OAuth2CodeGrantBasicAuth</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/OAuth2CodeGrantAzure.html">OAuth2CodeGrantAzure</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/OAuth2CodeGrantFacebook.html">OAuth2CodeGrantFacebook</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/OAuth2CodeGrantLinkedIn.html">OAuth2CodeGrantLinkedIn</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/OAuth2CodeGrantNoTokenType.html">OAuth2CodeGrantNoTokenType</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/OAuth2ClientCredentials.html">OAuth2ClientCredentials</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/OAuth2ClientCredentialsReddit.html">OAuth2ClientCredentialsReddit</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/OAuth2ImplicitGrant.html">OAuth2ImplicitGrant</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/OAuth2PasswordGrant.html">OAuth2PasswordGrant</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/OAuth2PasswordGrantDelegate.html">OAuth2PasswordGrantDelegate</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Errors%20%26%20Types.html">Errors &amp; Types</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/OAuth2Error.html">OAuth2Error</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Errors%20%26%20Types.html#/s:6OAuth20A4JSONa">OAuth2JSON</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Errors%20%26%20Types.html#/s:6OAuth20A10StringDicta">OAuth2StringDict</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Requests.html">Requests</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/OAuth2DataLoader.html">OAuth2DataLoader</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/OAuth2DataRequest.html">OAuth2DataRequest</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/OAuth2AuthRequest.html">OAuth2AuthRequest</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/OAuth2RequestPerformer.html">OAuth2RequestPerformer</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/OAuth2DataTaskRequestPerformer.html">OAuth2DataTaskRequestPerformer</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/OAuth2Response.html">OAuth2Response</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Requests.html#/s:6OAuth20A7Headersa">OAuth2Headers</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/OAuth2RequestParams.html">OAuth2RequestParams</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/OAuth2HTTPMethod.html">OAuth2HTTPMethod</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/OAuth2HTTPContentType.html">OAuth2HTTPContentType</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/OAuth2EndpointAuthMethod.html">OAuth2EndpointAuthMethod</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Dyn%20Reg.html">Dyn Reg</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/OAuth2DynReg.html">OAuth2DynReg</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Basics.html">Basics</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/OAuth2.html">OAuth2</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/OAuth2Base.html">OAuth2Base</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/OAuth2Requestable.html">OAuth2Requestable</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/OAuth2Securable.html">OAuth2Securable</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/OAuth2AuthConfig.html">OAuth2AuthConfig</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/OAuth2AuthConfig/UI.html">– UI</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/OAuth2ClientConfig.html">OAuth2ClientConfig</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Logging%20%26%20Debugging.html">Logging &amp; Debugging</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/OAuth2Logger.html">OAuth2Logger</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/OAuth2DebugLogger.html">OAuth2DebugLogger</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Enums/OAuth2LogLevel.html">OAuth2LogLevel</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/OAuth2DebugURLSessionDelegate.html">OAuth2DebugURLSessionDelegate</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Internals.html">Internals</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/OAuth2AuthorizerUI.html">OAuth2AuthorizerUI</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/OAuth2Authorizer.html">OAuth2Authorizer</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Protocols/OAuth2CustomAuthorizerUI.html">OAuth2CustomAuthorizerUI</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/OAuth2CustomAuthorizer.html">OAuth2CustomAuthorizer</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/OAuth2ContextStore.html">OAuth2ContextStore</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Structs/OAuth2KeychainAccount.html">OAuth2KeychainAccount</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/OAuth2WebViewController.html">OAuth2WebViewController</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Classes/OAuth2DataLoaderSessionTaskDelegate.html">OAuth2DataLoaderSessionTaskDelegate</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Other%20Extensions.html">Other Extensions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/CharacterSet.html">CharacterSet</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/Error.html">Error</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/HTTPURLResponse.html">HTTPURLResponse</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/String.html">String</a>
              </li>
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Extensions/URLRequest.html">URLRequest</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a class="nav-group-name-link" href="Other%20Functions.html">Other Functions</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a class="nav-group-task-link" href="Other%20Functions.html#/s:6OAuth216callOnMainThreadyyyyXEF">callOnMainThread(_:)</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">

        <section class="section">
          <div class="section-content top-matter">
            
            <h1 id='oauth2' class='heading'>OAuth2</h1>

<p><a href="https://travis-ci.org/p2/OAuth2"><img src="https://travis-ci.org/p2/OAuth2.svg?branch=main" alt="Build Status"></a>
<a href="LICENSE.txt"><img src="https://img.shields.io/:license-apache-blue.svg" alt="License"></a></p>

<p>OAuth2 frameworks for <strong>macOS</strong>, <strong>iOS</strong> and <strong>tvOS</strong> written in Swift 5.0.</p>

<ul>
<li><a href="#installation">⤵️ Installation</a></li>
<li><a href="#usage">🛠 Usage</a></li>
<li><a href="https://github.com/p2/OAuth2App">🖥 Sample macOS app</a> (with data loader examples)</li>
<li><a href="https://p2.github.io/OAuth2">📖 Technical Documentation</a></li>
</ul>

<p>OAuth2 requires Xcode 10.2, the built framework can be used on <strong>OS X 10.11</strong> or <strong>iOS 8</strong> and later.
Happy to accept pull requests, please see <a href="./CONTRIBUTING.md">CONTRIBUTING.md</a></p>
<h3 id='swift-version' class='heading'>Swift Version</h3>

<p>Since the Swift language is constantly evolving I have adopted a versioning scheme mirroring Swift versions:
the framework version&rsquo;s <strong>first two digits are always the Swift version</strong> the library is compatible with, see <a href="https://github.com/p2/OAuth2/releases">releases</a>.
Code compatible with brand new Swift versions are to be found on a separate feature branch named appropriately.</p>
<h2 id='usage' class='heading'>Usage</h2>

<p>To use OAuth2 in your own code, start with <code>import OAuth2</code> in your source files.</p>

<p>In OAuth2 there are <a href="https://tools.ietf.org/html/rfc6749#page-2"><strong>different kinds of <em>flows</em></strong></a>.
This library supports all of them, make sure you&rsquo;re using the correct one for your use-case and authorization server.
A typical <strong>code grant flow</strong> is used for demo purposes below.
The steps for other flows are mostly the same short of instantiating a different subclass and using different client settings.</p>

<p>Still not working?
See <a href="#site-specific-peculiarities">site-specific peculiarities</a>.</p>
<h3 id='1-instantiate-oauth2-with-a-settings-dictionary' class='heading'>1. Instantiate OAuth2 with a Settings Dictionary</h3>

<p>In this example you&rsquo;ll be building an iOS client to Github, so the code below will be somewhere in a view controller of yours, <em>maybe</em> the app delegate.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">oauth2</span> <span class="o">=</span> <span class="kt">OAuth2CodeGrant</span><span class="p">(</span><span class="nv">settings</span><span class="p">:</span> <span class="p">[</span>
    <span class="s">"client_id"</span><span class="p">:</span> <span class="s">"my_swift_app"</span><span class="p">,</span>
    <span class="s">"client_secret"</span><span class="p">:</span> <span class="s">"C7447242"</span><span class="p">,</span>
    <span class="s">"authorize_uri"</span><span class="p">:</span> <span class="s">"https://github.com/login/oauth/authorize"</span><span class="p">,</span>
    <span class="s">"token_uri"</span><span class="p">:</span> <span class="s">"https://github.com/login/oauth/access_token"</span><span class="p">,</span>   <span class="c1">// code grant only</span>
    <span class="s">"redirect_uris"</span><span class="p">:</span> <span class="p">[</span><span class="s">"myapp://oauth/callback"</span><span class="p">],</span>   <span class="c1">// register your own "myapp" scheme in Info.plist</span>
    <span class="s">"scope"</span><span class="p">:</span> <span class="s">"user repo:status"</span><span class="p">,</span>
    <span class="s">"secret_in_body"</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>    <span class="c1">// Github needs this</span>
    <span class="s">"keychain"</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>         <span class="c1">// if you DON'T want keychain integration</span>
<span class="p">]</span> <span class="k">as</span> <span class="kt">OAuth2JSON</span><span class="p">)</span>
</code></pre>

<p>See those <code>redirect_uris</code>?
You can use the scheme you want, but you must <strong>a)</strong> declare the scheme you use in your <code>Info.plist</code> and <strong>b)</strong> register the very same URI on the authorization server you connect to.</p>

<p>Note that <strong>as of iOS 9</strong>, you <em>should</em> use <a href="https://developer.apple.com/library/content/documentation/General/Conceptual/AppSearch/UniversalLinks.html">Universal Links</a> as your redirect URL, rather than a custom app scheme.
This prevents others from re-using your URI scheme and intercept the authorization flow.<br>
If you <strong>target iOS 12 and newer</strong> you should be using <code>ASWebAuthenticationSession</code>, which makes using your own local redirect scheme secure.</p>

<p>Want to avoid switching to Safari and pop up a SafariViewController or NSPanel?
Set this:</p>
<pre class="highlight swift"><code><span class="n">oauth2</span><span class="o">.</span><span class="n">authConfig</span><span class="o">.</span><span class="n">authorizeEmbedded</span> <span class="o">=</span> <span class="kc">true</span>
<span class="n">oauth2</span><span class="o">.</span><span class="n">authConfig</span><span class="o">.</span><span class="n">authorizeContext</span> <span class="o">=</span> <span class="o">&lt;</span><span class="err">#</span> <span class="n">your</span> <span class="kt">UIViewController</span> <span class="o">/</span> <span class="kt">NSWindow</span> <span class="err">#</span><span class="o">&gt;</span>
</code></pre>

<p>Need to specify a separate refresh token URI? You can set the <code>refresh_uri</code> in the Settings Dictionary. If specified the library will refresh access tokens using the <code>refresh_uri</code> you specified, otherwise it will use the <code>token_uri</code>.</p>

<p>Need to debug? Use a <code>.debug</code> or even a <code>.trace</code> logger:</p>
<pre class="highlight swift"><code><span class="n">oauth2</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="kt">OAuth2DebugLogger</span><span class="p">(</span><span class="o">.</span><span class="n">trace</span><span class="p">)</span>
</code></pre>

<p>For more see <a href="#advanced-settings">advanced settings</a> below.</p>
<h3 id='2-let-the-data-loader-or-alamofire-take-over' class='heading'>2. Let the Data Loader or Alamofire Take Over</h3>

<p>Starting with version 3.0, there is an <code><a href="Classes/OAuth2DataLoader.html">OAuth2DataLoader</a></code> class that you can use to retrieve data from an API.
It will automatically start authorization if needed and will ensure that this works even if you have multiple calls going on.
For details on how to configure authorization see step 4 below, in this example we&rsquo;ll use &ldquo;embedded&rdquo; authorization, meaning we&rsquo;ll show a SFSafariViewController on iOS if the user needs to log in.</p>

<p><a href="https://github.com/p2/OAuth2/wiki/Alamofire-5">This wiki page has all you need</a> to easily use OAuth2 with Alamofire instead.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">base</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="s">"https://api.github.com"</span><span class="p">)</span><span class="o">!</span>
<span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="nf">appendingPathComponent</span><span class="p">(</span><span class="s">"user"</span><span class="p">)</span>

<span class="k">var</span> <span class="nv">req</span> <span class="o">=</span> <span class="n">oauth2</span><span class="o">.</span><span class="nf">request</span><span class="p">(</span><span class="nv">forURL</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
<span class="n">req</span><span class="o">.</span><span class="nf">setValue</span><span class="p">(</span><span class="s">"application/vnd.github.v3+json"</span><span class="p">,</span> <span class="nv">forHTTPHeaderField</span><span class="p">:</span> <span class="s">"Accept"</span><span class="p">)</span>

<span class="k">self</span><span class="o">.</span><span class="n">loader</span> <span class="o">=</span> <span class="kt">OAuth2DataLoader</span><span class="p">(</span><span class="nv">oauth2</span><span class="p">:</span> <span class="n">oauth2</span><span class="p">)</span>
<span class="n">loader</span><span class="o">.</span><span class="nf">perform</span><span class="p">(</span><span class="nv">request</span><span class="p">:</span> <span class="n">req</span><span class="p">)</span> <span class="p">{</span> <span class="n">response</span> <span class="k">in</span>
    <span class="k">do</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">dict</span> <span class="o">=</span> <span class="k">try</span> <span class="n">response</span><span class="o">.</span><span class="nf">responseJSON</span><span class="p">()</span>
        <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
            <span class="c1">// you have received `dict` JSON data!</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="k">let</span> <span class="nv">error</span> <span class="p">{</span>
        <span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="k">async</span> <span class="p">{</span>
            <span class="c1">// an error occurred</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h3 id='3-make-sure-you-intercept-the-callback' class='heading'>3. Make Sure You Intercept the Callback</h3>

<p>When using the OS browser or the iOS 9+ Safari view controller, you will need to <strong>intercept the callback</strong> in your app delegate and let the OAuth2 instance handle the full URL:</p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">application</span><span class="p">(</span><span class="n">_</span> <span class="nv">app</span><span class="p">:</span> <span class="kt">UIApplication</span><span class="p">,</span>
              <span class="kd">open</span> <span class="nv">url</span><span class="p">:</span> <span class="kt">URL</span><span class="p">,</span>
               <span class="nv">options</span><span class="p">:</span> <span class="p">[</span><span class="kt">UIApplicationOpenURLOptionsKey</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]</span> <span class="o">=</span> <span class="p">[:])</span> <span class="o">-&gt;</span> <span class="kt">Bool</span> <span class="p">{</span>
    <span class="c1">// you should probably first check if this is the callback being opened</span>
    <span class="k">if</span> <span class="o">&lt;</span><span class="err">#</span> <span class="n">check</span> <span class="err">#</span><span class="o">&gt;</span> <span class="p">{</span>
        <span class="c1">// if your oauth2 instance lives somewhere else, adapt accordingly</span>
        <span class="n">oauth2</span><span class="o">.</span><span class="nf">handleRedirectURL</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>For iOS 13 make the callback in <code>SceneDelegate.swift</code></p>
<pre class="highlight swift"><code><span class="kd">func</span> <span class="nf">scene</span><span class="p">(</span><span class="n">_</span> <span class="nv">scene</span><span class="p">:</span> <span class="kt">UIScene</span><span class="p">,</span> <span class="n">openURLContexts</span> <span class="kt">URLContexts</span><span class="p">:</span> <span class="kt">Set</span><span class="o">&lt;</span><span class="kt">UIOpenURLContext</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="kt">URLContexts</span><span class="o">.</span><span class="n">first</span><span class="p">?</span><span class="o">.</span><span class="n">url</span> <span class="p">{</span>
        <span class="kt">AppDelegate</span><span class="o">.</span><span class="n">shared</span><span class="o">.</span><span class="n">oauth2</span><span class="p">?</span><span class="o">.</span><span class="nf">handleRedirectURL</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>

<p>You’re all set!</p>

<hr>

<p>If you want to dig deeper or do authorization yourself, here it goes:</p>
<h3 id='4-manually-authorize-the-user' class='heading'>4. Manually Authorize the User</h3>

<p>By default the OS browser will be used for authorization if there is no access token present or in the keychain.
<strong>Starting with iOS 12</strong>, <code>ASWebAuthenticationSession</code> will be used when enabling embedded authorization on iOS (previously, starting with iOS 9, <code>SFSafariViewController</code> was used instead).</p>

<p>To start authorization call <strong><code>authorize(params:callback:)</code></strong> or, to use embedded authorization, the convenience method <code>authorizeEmbedded(from:callback:)</code>.</p>

<p>The login screen will only be <strong>presented if needed</strong> (see <a href="#manually-performing-authorization">_Manually Performing Authorization</a> below for details) and will automatically <strong>dismiss</strong> the login screen on success.
See <a href="#advanced-settings"><em>Advanced Settings</em></a> for other options.</p>
<pre class="highlight swift"><code><span class="n">oauth2</span><span class="o">.</span><span class="nf">authorize</span><span class="p">()</span> <span class="p">{</span> <span class="n">authParameters</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">params</span> <span class="o">=</span> <span class="n">authParameters</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Authorized! Access token is in `oauth2.accessToken`"</span><span class="p">)</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Authorized! Additional parameters: </span><span class="se">\(</span><span class="n">params</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="s">"Authorization was canceled or went wrong: </span><span class="se">\(</span><span class="n">error</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>   <span class="c1">// error will not be nil</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// for embedded authorization you can simply use:</span>
<span class="n">oauth2</span><span class="o">.</span><span class="nf">authorizeEmbedded</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="o">&lt;</span><span class="err">#</span> <span class="n">presenting</span> <span class="n">view</span> <span class="n">controller</span> <span class="o">/</span> <span class="n">window</span> <span class="err">#</span><span class="o">&gt;</span><span class="p">)</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>

<span class="c1">// which is equivalent to:</span>
<span class="n">oauth2</span><span class="o">.</span><span class="n">authConfig</span><span class="o">.</span><span class="n">authorizeEmbedded</span> <span class="o">=</span> <span class="kc">true</span>
<span class="n">oauth2</span><span class="o">.</span><span class="n">authConfig</span><span class="o">.</span><span class="n">authorizeContext</span> <span class="o">=</span> <span class="o">&lt;</span><span class="err">#</span> <span class="n">presenting</span> <span class="n">view</span> <span class="n">controller</span> <span class="o">/</span> <span class="n">window</span> <span class="err">#</span><span class="o">&gt;</span>
<span class="n">oauth2</span><span class="o">.</span><span class="nf">authorize</span><span class="p">()</span> <span class="p">{</span> <span class="o">...</span> <span class="p">}</span>
</code></pre>

<p>Don&rsquo;t forget, when using the OS browser or the iOS 9+ Safari view controller, you will need to <strong>intercept the callback</strong> in your app delegate.
This is shown under step 2 above.</p>

<p>See <a href="#manually-performing-authorization"><em>Manually Performing Authorization</em></a> below for details on how to do this on the Mac.</p>
<h3 id='5-receive-callback' class='heading'>5. Receive Callback</h3>

<p>After everything completes the callback will be called, <strong>either</strong> with a non-nil <em>authParameters</em> dictionary (which may be empty!), <strong>or</strong> an error.
The access and refresh tokens and its expiration dates will already have been extracted and are available as <code>oauth2.accessToken</code> and <code>oauth2.refreshToken</code> parameters.
You only need to inspect the <em>authParameters</em> dictionary if you wish to extract additional information.</p>

<p>For advanced use outlined below, there is the <code>afterAuthorizeOrFail</code> block that you can use on your OAuth2 instance.
The <code>internalAfterAuthorizeOrFail</code> closure is, as its name suggests, provided for internal purposes – it is exposed for subclassing and compilation reasons and you should not mess with it.
As of version 3.0.2, you can no longer use the <code>onAuthorize</code> and <code>onFailure</code> callback properties, they have been removed entirely.</p>
<h3 id='6-make-requests' class='heading'>6. Make Requests</h3>

<p>You can now obtain an <code>OAuth2Request</code>, which is an already signed <code>MutableURLRequest</code>, to retrieve data from your server.
This request sets the <em>Authorization</em> header using the access token like so: <code>Authorization: Bearer {your access token}</code>.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">req</span> <span class="o">=</span> <span class="n">oauth2</span><span class="o">.</span><span class="nf">request</span><span class="p">(</span><span class="nv">forURL</span><span class="p">:</span> <span class="o">&lt;</span><span class="err">#</span> <span class="n">resource</span> <span class="kt">URL</span> <span class="err">#</span><span class="o">&gt;</span><span class="p">)</span>
<span class="c1">// set up your request, e.g. `req.HTTPMethod = "POST"`</span>
<span class="k">let</span> <span class="nv">task</span> <span class="o">=</span> <span class="n">oauth2</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="nf">dataTaskWithRequest</span><span class="p">(</span><span class="n">req</span><span class="p">)</span> <span class="p">{</span> <span class="n">data</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="p">{</span>
        <span class="c1">// something went wrong, check the error</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// check the response and the data</span>
        <span class="c1">// you have just received data with an OAuth2-signed request!</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="n">task</span><span class="o">.</span><span class="nf">resume</span><span class="p">()</span>
</code></pre>

<p>Of course you can use your own <code>URLSession</code> with these requests, you don&rsquo;t have to use <code>oauth2.session</code>; use <a href="https://github.com/p2/OAuth2/blob/main/Sources/Base/OAuth2DataLoader.swift">OAuth2DataLoader</a>, as shown in step 2, or hand it over to <em>Alamofire</em>.
<a href="https://github.com/p2/OAuth2/wiki/Alamofire-4">Here&rsquo;s all you need</a> to easily use OAuth2 with Alamofire.</p>
<h3 id='7-cancel-authorization' class='heading'>7. Cancel Authorization</h3>

<p>You can cancel an ongoing authorization any time by calling <code>oauth2.abortAuthorization()</code>.
This will cancel ongoing requests (like a code exchange request) or call the callback while you&rsquo;re waiting for a user to login on a webpage.
The latter will dismiss embedded login screens or redirect the user back to the app.</p>
<h3 id='8-re-authorize' class='heading'>8. Re-Authorize</h3>

<p>It is safe to always call <code>oauth2.authorize()</code> before performing a request.
You can also perform the authorization before the first request after your app became active again.
Or you can always intercept 401s in your requests and call authorize again before re-attempting the request.</p>
<h3 id='9-logout' class='heading'>9. Logout</h3>

<p>If you&rsquo;re storing tokens to the keychain, you can call <code>forgetTokens()</code> to throw them away.</p>

<p><strong>However</strong> your user is likely still logged in to the website, so on the next <code>authorize()</code> call, the web view may appear and immediately disappear.
When using the built-in web view on iOS 8, one can use the following snippet to throw away any cookies the app created.
With the newer <code>SFSafariViewController</code>, or logins performed in the browser, it&rsquo;s probably best to directly <strong>open the logout page</strong> so the user sees the logout happen.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">storage</span> <span class="o">=</span> <span class="kt">HTTPCookieStorage</span><span class="o">.</span><span class="n">shared</span>
<span class="n">storage</span><span class="o">.</span><span class="n">cookies</span><span class="p">?</span><span class="o">.</span><span class="nf">forEach</span><span class="p">()</span> <span class="p">{</span> <span class="n">storage</span><span class="o">.</span><span class="nf">deleteCookie</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span> <span class="p">}</span>
</code></pre>
<h2 id='manually-performing-authorization' class='heading'>Manually Performing Authorization</h2>

<p>The <code>authorize(params:callback:)</code> method will:</p>

<ol>
<li>Check if an authorize call is already running, if yes it will abort with an <code><a href="Enums/OAuth2Error.html#/s:6OAuth20A5ErrorO18alreadyAuthorizingyA2CmF">OAuth2Error.alreadyAuthorizing</a></code> error</li>
<li>Check if an access token that has not yet expired is already present (or in the keychain), if not</li>
<li>Check if a refresh token is available, if found</li>
<li>Try to use the refresh token to get a new access token, if it fails</li>
<li>Start the OAuth2 dance by using the <code>authConfig</code> settings to determine how to display an authorize screen to the user</li>
</ol>

<p>Your <code>oauth2</code> instance will use an automatically created <code>URLSession</code> using an <code>ephemeralSessionConfiguration()</code> configuration for its requests, exposed on <code>oauth2.session</code>.
You can set <code>oauth2.sessionConfiguration</code> to your own configuration, for example if you&rsquo;d like to change timeout values.
You can also set <code>oauth2.sessionDelegate</code> to your own session delegate if you like.</p>

<p>The wiki has <a href="https://github.com/p2/OAuth2/wiki/Call-Graph">the complete call graph</a> of the <em>authorize()</em> method.
If you do <strong>not wish this kind of automation</strong>, the manual steps to show and hide the authorize screens are:</p>

<p><strong>Embedded iOS</strong>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="k">try</span> <span class="n">oauth2</span><span class="o">.</span><span class="nf">authorizeURL</span><span class="p">(</span><span class="nv">params</span><span class="p">:</span> <span class="o">&lt;</span><span class="err">#</span> <span class="n">custom</span> <span class="n">parameters</span> <span class="n">or</span> <span class="kc">nil</span> <span class="err">#</span><span class="o">&gt;</span><span class="p">)</span>
<span class="n">oauth2</span><span class="o">.</span><span class="n">authConfig</span><span class="o">.</span><span class="n">authorizeEmbeddedAutoDismiss</span> <span class="o">=</span> <span class="kc">false</span>
<span class="k">let</span> <span class="nv">web</span> <span class="o">=</span> <span class="k">try</span> <span class="n">oauth2</span><span class="o">.</span><span class="n">authorizer</span><span class="o">.</span><span class="nf">authorizeSafariEmbedded</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="o">&lt;</span><span class="err">#</span> <span class="n">view</span> <span class="n">controller</span> <span class="err">#</span><span class="o">&gt;</span><span class="p">,</span> <span class="nv">at</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
<span class="n">oauth2</span><span class="o">.</span><span class="n">afterAuthorizeOrFail</span> <span class="o">=</span> <span class="p">{</span> <span class="n">authParameters</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
    <span class="c1">// inspect error or oauth2.accessToken / authParameters or do something else</span>
    <span class="n">web</span><span class="o">.</span><span class="nf">dismissViewControllerAnimated</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="nv">completion</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p><strong>Modal Sheet on macOS</strong>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">window</span> <span class="o">=</span> <span class="o">&lt;</span><span class="err">#</span> <span class="n">window</span> <span class="n">to</span> <span class="n">present</span> <span class="n">from</span> <span class="err">#</span><span class="o">&gt;</span>
<span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="k">try</span> <span class="n">oauth2</span><span class="o">.</span><span class="nf">authorizeURL</span><span class="p">(</span><span class="nv">params</span><span class="p">:</span> <span class="o">&lt;</span><span class="err">#</span> <span class="n">custom</span> <span class="n">parameters</span> <span class="n">or</span> <span class="kc">nil</span> <span class="err">#</span><span class="o">&gt;</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">sheet</span> <span class="o">=</span> <span class="k">try</span> <span class="n">oauth2</span><span class="o">.</span><span class="n">authorizer</span><span class="o">.</span><span class="nf">authorizeEmbedded</span><span class="p">(</span><span class="nv">from</span><span class="p">:</span> <span class="n">window</span><span class="p">,</span> <span class="nv">at</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
<span class="n">oauth2</span><span class="o">.</span><span class="n">afterAuthorizeOrFail</span> <span class="o">=</span> <span class="p">{</span> <span class="n">authParameters</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
    <span class="c1">// inspect error or oauth2.accessToken / authParameters or do something else</span>
    <span class="n">window</span><span class="o">.</span><span class="nf">endSheet</span><span class="p">(</span><span class="n">sheet</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>

<p><strong>New window on macOS</strong>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="k">try</span> <span class="n">oauth2</span><span class="o">.</span><span class="nf">authorizeURL</span><span class="p">(</span><span class="nv">params</span><span class="p">:</span> <span class="o">&lt;</span><span class="err">#</span> <span class="n">custom</span> <span class="n">parameters</span> <span class="n">or</span> <span class="kc">nil</span> <span class="err">#</span><span class="o">&gt;</span><span class="p">)</span>
<span class="k">let</span> <span class="nv">windowController</span> <span class="o">=</span> <span class="k">try</span> <span class="n">oauth2</span><span class="o">.</span><span class="n">authorizer</span><span class="o">.</span><span class="nf">authorizeInNewWindow</span><span class="p">(</span><span class="nv">at</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>
<span class="n">oauth2</span><span class="o">.</span><span class="n">afterAuthorizeOrFail</span> <span class="o">=</span> <span class="p">{</span> <span class="n">authParameters</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
    <span class="c1">// inspect error or oauth2.accessToken / authParameters or do something else</span>
    <span class="n">windowController</span><span class="o">.</span><span class="n">window</span><span class="p">?</span><span class="o">.</span><span class="nf">close</span><span class="p">()</span>
<span class="p">}</span>
</code></pre>

<p><strong>iOS/macOS browser</strong>:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="k">try</span> <span class="n">oauth2</span><span class="o">.</span><span class="nf">authorizeURL</span><span class="p">(</span><span class="nv">params</span><span class="p">:</span> <span class="o">&lt;</span><span class="err">#</span> <span class="n">custom</span> <span class="n">parameters</span> <span class="n">or</span> <span class="kc">nil</span> <span class="err">#</span><span class="o">&gt;</span><span class="p">)</span>
<span class="k">try</span> <span class="n">oauth2</span><span class="o">.</span><span class="n">authorizer</span><span class="o">.</span><span class="nf">openAuthorizeURLInBrowser</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
<span class="n">oauth2</span><span class="o">.</span><span class="n">afterAuthorizeOrFail</span> <span class="o">=</span> <span class="p">{</span> <span class="n">authParameters</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
    <span class="c1">// inspect error or oauth2.accessToken / authParameters or do something else</span>
<span class="p">}</span>
</code></pre>

<p><strong>macOS</strong></p>

<p>See the <a href="https://github.com/p2/OAuth2App">OAuth2 Sample App</a>&rsquo;s AppDelegate class on how to receive the callback URL in your Mac app.
If the authorization displays the code to the user, e.g. with Google&rsquo;s <code>urn:ietf:wg:oauth:2.0:oob</code> callback URL, you can retrieve the code from the user&rsquo;s pasteboard and continue authorization with:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">pboard</span> <span class="o">=</span> <span class="kt">NSPasteboard</span><span class="o">.</span><span class="nf">general</span><span class="p">()</span>
<span class="k">if</span> <span class="k">let</span> <span class="nv">pasted</span> <span class="o">=</span> <span class="n">pboard</span><span class="o">.</span><span class="nf">string</span><span class="p">(</span><span class="nv">forType</span><span class="p">:</span> <span class="kt">NSPasteboardTypeString</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">oauth2</span><span class="o">.</span><span class="nf">exchangeCodeForToken</span><span class="p">(</span><span class="n">pasted</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
<h2 id='flows' class='heading'>Flows</h2>

<p>Based on which OAuth2 flow that you need you will want to use the correct subclass.
For a very nice explanation of OAuth&rsquo;s basics: <a href="http://oauthbible.com/#oauth-2-three-legged">The OAuth Bible</a>.</p>
<h4 id='code-grant' class='heading'>Code Grant</h4>

<p>For a full OAuth 2 code grant flow (<code>response_type=code</code>) you want to use the <code><a href="Classes/OAuth2CodeGrant.html">OAuth2CodeGrant</a></code> class.
This flow is typically used by applications that can guard their secrets, like server-side apps, and not in distributed binaries.
In case an application cannot guard its secret, such as a distributed iOS app, you would use the <em>implicit grant</em> or, in some cases, still a <em>code grant</em> but omitting the client secret.
It has however become common practice to still use code grants from mobile devices, including a client secret.</p>

<p>This class fully supports those flows, it automatically creates a “Basic” Authorization header if the client has a non-nil client secret.
This means that you likely <strong>must</strong> specify <code>client_secret</code> in your settings; if there is none (like for <a href="https://github.com/reddit/reddit/wiki/OAuth2#token-retrieval-code-flow">Reddit</a>) specify the empty string.
If the site requires client credentials in the request body, set <code>clientConfig.secretInBody</code> to true, as explained below.</p>
<h4 id='implicit-grant' class='heading'>Implicit Grant</h4>

<p>An implicit grant (<code>response_type=token</code>) is suitable for apps that are not capable of guarding their secret, such as distributed binaries or client-side web apps.
Use the <code><a href="Classes/OAuth2ImplicitGrant.html">OAuth2ImplicitGrant</a></code> class to receive a token and perform requests.</p>

<p>Would be nice to add another code example here, but it&rsquo;s pretty much the same as for the <em>code grant</em>.</p>
<h4 id='client-credentials' class='heading'>Client Credentials</h4>

<p>A 2-legged flow that lets an app authorize itself via its client id and secret.
Instantiate <code><a href="Classes/OAuth2ClientCredentials.html">OAuth2ClientCredentials</a></code>, as usual supplying <code>client_id</code> but also a <code>client_secret</code> – plus your other configurations – in the settings dict, and you should be good to go.</p>
<h4 id='username-and-password' class='heading'>Username and Password</h4>

<p>The <em>Resource Owner Password Credentials Grant</em> is supported with the <code><a href="Classes/OAuth2PasswordGrant.html">OAuth2PasswordGrant</a></code> subclass.
Create an instance as shown above, set its <code>username</code> and <code>password</code> properties, then call <code>authorize()</code>.</p>
<h2 id='site-specific-peculiarities' class='heading'>Site-Specific Peculiarities</h2>

<p>Some sites might not strictly adhere to the OAuth2 flow, from returning data differently like Facebook to omitting mandatory return parameters like Instagram &amp; co.
The framework deals with those deviations by creating site-specific subclasses and/or configuration details.
If you need to pass additional <strong>headers</strong> or <strong>parameters</strong>, you can supply these in the settings dict like so:</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">oauth2</span> <span class="o">=</span> <span class="kt">OAuth2CodeGrant</span><span class="p">(</span><span class="nv">settings</span><span class="p">:</span> <span class="p">[</span>
    <span class="s">"client_id"</span><span class="p">:</span> <span class="s">"..."</span><span class="p">,</span>
    <span class="o">...</span>
    <span class="s">"headers"</span><span class="p">:</span> <span class="p">[</span><span class="s">"Accept"</span><span class="p">:</span> <span class="s">"application/vnd.github.v3+json"</span><span class="p">],</span>
    <span class="s">"parameters"</span><span class="p">:</span> <span class="p">[</span><span class="s">"duration"</span><span class="p">:</span> <span class="s">"permanent"</span><span class="p">],</span>
<span class="p">]</span> <span class="k">as</span> <span class="kt">OAuth2JSON</span><span class="p">)</span>
</code></pre>

<ul>
<li><a href="https://github.com/p2/OAuth2/wiki/GitHub">GitHub</a></li>
<li><a href="https://github.com/p2/OAuth2/wiki/Facebook">Facebook</a></li>
<li><a href="https://github.com/p2/OAuth2/wiki/Reddit">Reddit</a></li>
<li><a href="https://github.com/p2/OAuth2/wiki/Google">Google</a></li>
<li><a href="https://github.com/p2/OAuth2/wiki/LinkedIn">LinkedIn</a></li>
<li><a href="https://github.com/p2/OAuth2/wiki/Instagram,-Bitly,-Pinterest-and-others">Instagram, Bitly, Pinterest, &hellip;</a></li>
<li><a href="https://github.com/p2/OAuth2/wiki/Uber">Uber</a></li>
<li><a href="https://github.com/p2/OAuth2/wiki/BitBucket">BitBucket</a></li>
</ul>
<h2 id='advanced-settings' class='heading'>Advanced Settings</h2>

<p>The main configuration you&rsquo;ll use with <code>oauth2.authConfig</code> is whether or not to use an embedded login:</p>
<pre class="highlight plaintext"><code>oauth2.authConfig.authorizeEmbedded = true
</code></pre>

<p>Similarly, if you want to take care of dismissing the login screen yourself (not possible with the newer authorization sessions mentioned below):</p>
<pre class="highlight plaintext"><code>oauth2.authConfig.authorizeEmbeddedAutoDismiss = false
</code></pre>

<p>Some sites also want the client-id/secret combination in the request <em>body</em>, not in the <em>Authorization</em> header:</p>
<pre class="highlight plaintext"><code>oauth2.clientConfig.secretInBody = true
// or in your settings:
"secret_in_body": true
</code></pre>

<p>Sometimes you also need to provide additional authorization parameters.
This can be done in 3 ways:</p>
<pre class="highlight plaintext"><code>oauth2.authParameters = ["duration": "permanent"]
// or in your settings:
"parameters": ["duration": "permanent"]
// or when you authorize manually:
oauth2.authorize(params: ["duration": "permanent"]) { ... }
</code></pre>

<p>Similar is how you specify custom HTTP headers:</p>
<pre class="highlight plaintext"><code>oauth2.clientConfig.authHeaders = ["Accept": "application/json, text/plain"]
// or in your settings:
"headers": ["Accept": "application/json, text/plain"]
</code></pre>

<p>Starting with version 2.0.1 on iOS 9, <code>SFSafariViewController</code> will be used for embedded authorization.
Starting after version 4.2, on iOS 11 (<code>SFAuthenticationSession</code>) and iOS 12 (<code>ASWebAuthenticationSession</code>), you can opt-in to these newer authorization session view controllers:</p>
<pre class="highlight plaintext"><code>oauth2.authConfig.ui.useAuthenticationSession = true
</code></pre>

<p>To revert to the old custom <code><a href="Classes/OAuth2WebViewController.html">OAuth2WebViewController</a></code>, which you <em>should not do</em> because <code>ASWebAuthenticationSession</code> is way more secure:</p>
<pre class="highlight plaintext"><code>oauth2.authConfig.ui.useSafariView = false
</code></pre>

<p>To customize the <em>go back</em> button when using <code><a href="Classes/OAuth2WebViewController.html">OAuth2WebViewController</a></code> on iOS 8 and older:</p>
<pre class="highlight plaintext"><code>oauth2.authConfig.ui.backButton = &lt;# UIBarButtonItem(...) #&gt;
</code></pre>

<p>See below for settings about <a href="#keychain">the keychain</a> and <a href="#pkce">PKCE</a>.</p>
<h2 id='usage-with-alamofire' class='heading'>Usage with Alamofire</h2>

<p>You&rsquo;ll get the best experience when using Alamofire v4 or newer and OAuth2 v3 and newer:</p>

<ul>
<li>How to use Alamofire <a href="https://github.com/p2/OAuth2/wiki/Alamofire-4">version 4 and newer</a></li>
<li>How to use <a href="https://github.com/p2/OAuth2/wiki/Alamofire-3">version 3 and older</a></li>
</ul>
<h2 id='dynamic-client-registration' class='heading'>Dynamic Client Registration</h2>

<p>There is support for <a href="https://tools.ietf.org/html/rfc7591">dynamic client registration</a>.
If during setup <code>registration_url</code> is set but <code>client_id</code> is not, the <code>authorize()</code> call automatically attempts to register the client before continuing to the actual authorization.
Client credentials returned from registration are stored to the keychain.</p>

<p>The <code><a href="Classes/OAuth2DynReg.html">OAuth2DynReg</a></code> class is responsible for handling client registration.
You can use its <code>register(client:callback:)</code> method manually if you need to.
Registration parameters are taken from the client&rsquo;s configuration.</p>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">oauth2</span> <span class="o">=</span> <span class="kt">OAuth2</span><span class="o">...</span><span class="p">()</span>
<span class="n">oauth2</span><span class="o">.</span><span class="nf">registerClientIfNeeded</span><span class="p">()</span> <span class="p">{</span> <span class="n">error</span> <span class="k">in</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="p">{</span>
        <span class="c1">// registration failed</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// client was registered</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<pre class="highlight swift"><code><span class="k">let</span> <span class="nv">oauth2</span> <span class="o">=</span> <span class="kt">OAuth2</span><span class="o">...</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">dynreg</span> <span class="o">=</span> <span class="kt">OAuth2DynReg</span><span class="p">()</span>
<span class="n">dynreg</span><span class="o">.</span><span class="nf">register</span><span class="p">(</span><span class="nv">client</span><span class="p">:</span> <span class="n">oauth2</span><span class="p">)</span> <span class="p">{</span> <span class="n">params</span><span class="p">,</span> <span class="n">error</span> <span class="k">in</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">error</span> <span class="o">=</span> <span class="n">error</span> <span class="p">{</span>
        <span class="c1">// registration failed</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="c1">// client was registered with `params`</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
<h2 id='pkce' class='heading'>PKCE</h2>

<p>PKCE support is controlled by the <code>useProofKeyForCodeExchange</code> property, and the <code>use_pkce</code> key in the settings dictionary.
It is disabled by default. When enabled, a new code verifier string is generated for every authorization request. </p>
<h2 id='keychain' class='heading'>Keychain</h2>

<p>This framework can transparently use the iOS and macOS keychain.
It is controlled by the <code>useKeychain</code> property, which can be disabled during initialization with the <code>keychain</code> settings dictionary key.
Since this is <strong>enabled by default</strong>, if you do <em>not</em> turn it off during initialization, the keychain will be queried for tokens and client credentials related to the authorization URL.
If you turn it off <em>after</em> initialization, the keychain will be queried for existing tokens, but new tokens will not be written to the keychain.</p>

<p>If you want to delete the tokens from keychain, i.e. <strong>log the user out</strong> completely, call <code>forgetTokens()</code>.
If you have dynamically registered your client and want to start anew, you can call <code>forgetClient()</code>.</p>

<p>Ideally, access tokens get delivered with an &ldquo;expires_in&rdquo; parameter that tells you how long the token is valid.
If it is missing the framework will still use those tokens if one is found in the keychain and not re-perform the OAuth dance.
You will need to intercept 401s and re-authorize if an access token has expired but the framework has still pulled it from the keychain.
This behavior can be turned off by supplying <code>token_assume_unexpired: false</code> in settings or setting <code>clientConfig.accessTokenAssumeUnexpired</code> to false.</p>

<p>These are the settings dictionary keys you can use for more control:</p>

<ul>
<li><code>keychain</code>: a bool on whether to use keychain or not, true by default</li>
<li><code>keychain_access_mode</code>: a string value for keychain kSecAttrAccessible attribute, &ldquo;kSecAttrAccessibleWhenUnlocked&rdquo; by default, you can change this to e.g. &ldquo;kSecAttrAccessibleAfterFirstUnlock&rdquo; if you need the tokens to be available when the phone is locked.</li>
<li><code>keychain_access_group</code>: a string value for keychain kSecAttrAccessGroup attribute, nil by default</li>
<li><code>keychain_account_for_client_credentials</code>: the name to use to identify client credentials in the keychain, &ldquo;clientCredentials&rdquo; by default</li>
<li><code>keychain_account_for_tokens</code>: the name to use to identify the tokens in the keychain, &ldquo;currentTokens&rdquo; by default</li>
</ul>
<h2 id='installation' class='heading'>Installation</h2>

<p>You can use the <em>Swift Package Manager</em>, <em>git</em> or <em>Carthage</em>.
The preferred way is to use the <em>Swift Package Manager</em>.</p>
<h4 id='swift-package-manager' class='heading'>Swift Package Manager</h4>

<p>In Xcode 11 and newer, choose &ldquo;File&rdquo; from the Xcode Menu, then &ldquo;Swift Packages&rdquo; » &ldquo;Add Package Dependency&hellip;&rdquo; and paste the URL of this repo: <code>https://github.com/p2/OAuth2.git</code>. Pick a version and Xcode should do the rest.</p>
<h4 id='carthage' class='heading'>Carthage</h4>

<p>Installation via Carthage is easy enough:</p>
<pre class="highlight ruby"><code><span class="n">github</span> <span class="s2">"p2/OAuth2"</span> <span class="o">~&gt;</span> <span class="mf">4.2</span>
</code></pre>
<h4 id='git' class='heading'>git</h4>

<p>Using Terminal.app, clone the OAuth2 repository, best into a subdirectory of your app project:  </p>
<pre class="highlight plaintext"><code>$ cd path/to/your/app
$ git clone --recursive https://github.com/p2/OAuth2.git
</code></pre>

<p>If you&rsquo;re using git you&rsquo;ll want to add it as a submodule.
Once cloning completes, open your app project in Xcode and add <code>OAuth2.xcodeproj</code> to your app:</p>

<p><img src="assets/step-adding.png" alt="Adding to Xcode"></p>

<p>Now link the framework to your app:</p>

<p><img src="assets/step-linking.png" alt="Linking"></p>

<p>These three steps are needed to:</p>

<ol>
<li>Make your App also build the framework</li>
<li>Link the framework into your app</li>
<li>Embed the framework in your app when distributing</li>
</ol>
<h2 id='license' class='heading'>License</h2>

<p>This code is released under the <a href="LICENSE.txt"><em>Apache 2.0 license</em></a>, which means that you can use it in open as well as closed source projects.
Since there is no <code>NOTICE</code> file there is nothing that you have to include in your product.</p>

          </div>
        </section>


      </article>
    </div>
    <section class="footer">
      <p>&copy; 2024 <a class="link" href="https://github.com/p2" target="_blank" rel="external noopener">Pascal Pfiffner</a>. All rights reserved. (Last updated: 2024-02-08)</p>
      <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external noopener">jazzy ♪♫ v0.14.4</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external noopener">Realm</a> project.</p>
    </section>
  </body>
</html>
